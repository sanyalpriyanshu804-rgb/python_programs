from datetime import datetime

def input_validation(text, prompt):
    while True:
        a=input(f'Enter the {text}: ')
        if a.isdigit():
            a = int(a)
            if a < 0:
                print(prompt)

            else:
                return a
        else:
            print('Enter a valid (+ve)integer !')

def ask_retry():
    while True:
        a=input('Do you want to continue using this program? (Y/N): ').strip().lower()
        if a in ['y','yes']:
            return True
        elif a in ['n', 'no']:
            return False
        else:
            print('Choose a valid option (Y for yes and N for no)')
            print()

def is_prime(n):
    factors=set()
    prime=True
    for i in range(2,int(n**0.5)+1):
        if n%i ==0:
            prime=False
            factors.add(i)
            factors.add(int(n/i))
    return prime, list(factors)

def choose_option():
    while True:
        print('1. Check a single number.')
        print('2. Check a range of numbers.')
        a=input('Enter the choice: ')
        if a.isdigit():
            a=int(a)
            if a in [1, 2]:
                return a
            else:
                print('Enter a valid choice!')
                print()
        else:
            print('Enter a valid choice!')
            print()

def start_stop():
    while True:
        start=input_validation('starting point', 'starting point can\'t be negative.')
        stop=input_validation('ending point', 'ending point can\'t be negative.')
        if stop>start:
            return start, stop
        else:
            print('Starting point can\'t be lesser than stoping point!')
            print()


print('''
This is a prime number checker.
Try it and have fun!
''')

entry_no=input('Enter the entry number of this session: ')
with open(r"C:\Users\Home\Desktop\monthly_budget.txt",'a') as file:
    file.write(f'\n')
    file.write("*"*20)
    file.write(f"\n{entry_no}")
    file.write(f"\nTime: {datetime.now()}")
    count=0

    while True:
        choice=choose_option()
        if choice==1:
            num=input_validation('number', '❌Prime numbers can\'t be negative.')
            if num==2:
                print(f'✅{num} is a prime number.')
                file.write(f'\n{num} is a prime number.')
            elif num==1 or num==0:
                print(f'❌{num} is not a prime number.')
                file.write(f'\n{num} is not a prime number.')
            elif num==0:
                print(f'❌{num} is neither a prime nor a composite number.')
                file.write(f'\n{num} is neither a prime nor a composite number.')
            else:
                prime, factors = is_prime(num)
                if prime:
                    print(f'✅{num} is a prime number.')
                    print()
                    file.write(f'\n{num} is a prime number.')
                else:
                    print(f'❌{num} is not a prime number.')
                    file.write(f'\n{num} is not a prime number.')

                    print('Because it has factors:- ',end=' ')
                    file.write('\nBecause it has factors:- ')

                    for i in sorted(factors):
                        print(i,end=", ")
                        file.write(str(i)+', ')
                    print()
                    print()
        else:
            start, stop = start_stop()
            print(f'The prime numbers between {start} and {stop} are:')
            file.write(f'\nThe prime numbers between {start} and {stop} are:\n')
            for i in range(start, stop+1):
                prime, factors= is_prime(i)
                if prime:
                    print(i,end=', ')
                    file.write(str(i)+', ')
            print()
            print()
        count+=1
        if not ask_retry():
            break
        else:
            print('\nContinuing program...')
            print()
    print(f'Thanks for using this program!\nHave a nice day :)\nYou checked {count} numbers in this session')
    file.write(f'\nYou used this program {count} times in this session')
    file.write(f'\n'+'*'*20)
